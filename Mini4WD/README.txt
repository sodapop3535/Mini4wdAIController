１．概要

このプログラムはミニ四駆制御システム第3段?であり，
ミニ四駆を動画内で検知して制御するシステムです．

なおここで説明している環境はすべてWindowsを想定しています．
パスなどの説明もすべてWindowsを想定しています．
若干説明が異なるかもしれませんがご了承ください．
加えて,Macでこれを実行する場合は".setting"ファイルの

Mini4WDPortName=COM4
を
Mini4WDPortName=/dev/tty.RNBT-4EA9-RNI-SPP

などに変更してください．これはミニ四駆と接続するBluetoothのポート名です．
なお，ここで指定する値はAIchipMasterのマニュアルを参考にしています．
一度マニュアルを読んで設定を行い，sample_Appなどのサンプルプログラム
を実行して正常に通信できることを確認することを強く推奨します．


２．大まかな環境設定

このプログラムを動かすには以下の環境が必要

・python 3.7.7
・Java SE8 (jre 1.8)

これらを必要に応じてインストールして，ターミナルでpythonコマンドとjavaコマンド
が実行できるようにしておいてください．
これらがインストールできたら以下の章に進んでください．
なお，バージョンがこれら以上であれば基本的には実行に問題ありません．


３．python環境設定

加えてpythonには標準ライブラリに加えて以下のパッケージが必要です．
これらをpip installしてください．
なおこれらは仮想環境を作成してその中にインストールすることが望ましいです．
============
追加パッケージ
opencv
numpy
PIL
py4j
matplotlib
wxPython
============

４．Java環境設定

Javaの環境設定は基本的に必要ありません．
必要な拡張パッケージはすべてこのカレントディレクトリ以降のフォルダに格納されています．
しかし場合によってはクラスローダーによって読み込まれないこともあるかもしれません．
その場合は①のフォルダに格納されているファイルを丸ごと②のフォルダ
にコピーアンドペーストしてください．②はJavaの本体のクラスローダーが必ず読み込む
場所なので，そこに入れたファイルは必ずJava本体に読み込まれます．
それでもエラーが発生する場合，javaコマンドを実行しているJRE(Javaの実行環境)が
そこではないかもしれません．別のフォルダにJREがないか確認してみてください．

①./workspace/Mini4WD/lib	（注:"./"はカレントディレクトリのこと）
②c://Program Files/Java/jre***/ext/lib/ext


５．実行方法

最後に実行方法を説明します．以下の操作を順番に行い，実行してください．
I.ミニ四駆を通信モードで起動する（詳しくはマニュアルを参照のこと）
II.仮想環境をactivateする
III.ターミナルでpython Mini4WD.pyとコマンドを打つ．

これで1章で紹介した動画のようになれば問題ありません．
しかしおそらくはじめのうちはどうしてもエラーが発生すると思います．
その場合，以下の対処法を参照してください．

実行時に発生するエラーは主に二種類あります．

一つ目に，JVM上でJavaのプログラムをローカルホストサーバとして実行した際に
そのローカルホストが使いたいポートがすでにほかのプログラムによって
独占されていることにより発生するエラーです．Py4j Port Bind Errorなどと表示されます．
この場合，".setting"の
M4DSPortNum=25335
を25317～25349のいずれかの値に変更してください．

二つ目に，ミニ四駆と接続できないことによるエラーです．"COM4" Port Busyなどと
表示されます．複数回実行してなおもこのエラーが発生する場合
まず"./setting"ファイル内の値が実際に通信しているポート
と違っていないか確認してください．次にミニ四駆の起動時に通信モードで起動できていない
場合が考えられます．ミニ四駆をもう一度再起動してください．
それでも解決しない場合，ミニ四駆の搭載バッテリーや単三電池の容量が十分か確認して
ください．

これでもエラーが解決されない場合，3章や４章の戻って設定の確認を行ってください．
